---
import Layout from "../components/Layout.astro";

import { locale } from "../utils/locale";

import { supabase } from "../utils/supabaseBrowser";

type FormText = {
  buttonText: string;
  confirm?: string;
  error?: string;
};

const { access_token, refresh_token } = Astro.params;

const formText: FormText = {
  buttonText: locale.update_password?.button_label ?? "Submit",
  confirm: undefined,
  error: undefined,
};

if (access_token && refresh_token) {
  supabase.auth.setSession({
    access_token,
    refresh_token,
  });
}
---

<Layout title="update">
  <div
    style={{
      display: "flex",
      alignItems: "stretch",
      justifyContent: "center",
    }}
  >
    <form
      action="/api/auth/update-password"
      method="post"
      style={{
        boxShadow: "1px 1px 3px #ccc",
        borderRadius: "8px",
        padding: "20px",
        display: "flex",
        flexDirection: "column",
        justifyContent: "center",
        maxWidth: "35rem",
        gap: "1rem",
      }}
    >
      <label
        style={{
          display: "flex",
          flexDirection: "column",
        }}
      >
        {locale.update_password?.password_label}
        <input id="password" name="password" type="password" required />
      </label>
      <button
        type="submit"
        style={{
          backgroundColor: "var(--accent)",
          border: "none",
          padding: "6px 10px",
          fontSize: "large",
          color: "white",
          cursor: "pointer",
          borderRadius: "6px",
        }}
      >
        <span>{formText.buttonText}</span>
      </button>
      {formText.error && <label>{formText.error}</label>}
      {formText.confirm && <label>{formText.confirm}</label>}
    </form>
  </div>
</Layout>
